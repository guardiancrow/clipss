# clipss \- Windows用画面キャプチャソフトウエア

## 概要

clipssはWindows用画面キャプチャソフトウエアです

## 特徴

　設計のコンセプトは、キャプチャ画像を誰かと共有することを前提に「手軽にキャプチャできて小さなファイルサイズになるように出力すること」でした。以下のような特徴があります。

- 手軽にキャプチャできる
- キャプチャする際にソフトウエア自体が邪魔にならない
- ゲーム画面や動画再生画面もキャプチャできる
- 選択矩形の他、ウインドウ、クライアント領域、フルスクリーンと領域を選べる
- 別のウインドウに一部が隠れているウインドウもキャプチャ
- マルチディスプレイサポート
- カラーマネジメントサポート
- 最適化されたJPEGとPNGファイルの出力サポート
- 画像データにExifやその他のメタデータを埋め込まない

　スクリーンショットを撮って公開する場合の一般的なプロセス｛「キャプチャ」 -> 「プライバシーデータの破棄」 -> 「投稿用に再圧縮」｝ -> 「投稿」の｛｝の部分をまとめて行うのがこのソフトウエアです。

　**「撮ったらすぐ公開できる」** を目的にしたことが最大の特徴です。

_clipssが作成する画像ファイルはインターネット上で不特定多数の人に公開する場合を考慮し、撮影情報や使用ソフトなどの情報が入っていないデータを出力します。しかし、写っている内容に関するプライバシーの保護はもちろん保証するものではないことに注意してください。_


## 使用言語

- C/C++ (MinGW g++)
- Windows API

## 必須環境

- MinGW
- CMake

## 必須ライブラリ

- zlib
- libpng-1.6.x
- mozjpeg または libjpeg-9a

_他のバージョンの場合、メイクファイルの書き換えが必要です_

## 推奨環境

- msys

## ライセンス

　MITライセンス

　[http://opensource.org/licenses/mit-license.php](http://opensource.org/licenses/mit-license.php)

## ソースコードについて

- makeする前にご使用の環境下に合わせてメイクファイルのlibjpeg/libpng/zlibのパスを変更してください<del>（autotoolsは甘え）</del>
- 文字コードはBOM付きUTF-8形式で保存することを推奨します。OSを超えた操作を行う場合はShift-JISよりも良いかなと思った次第です。現状Windowsのみの利用ですので無意味かもしれませんが
- 一応cppですが、ほぼC++染みたことはしていないので無駄かなあとも思っています。今後の懸案事項です

## ビルド方法

_まずメイクファイル内の必須ライブラリのソースコードのあるパスを設定し直してください_

msysの場合（shが使える場合）

    $ make

mozjpegを使用する場合はUSE_MOZJPEG=1を与えます

    $ make USE_MOZJPEG=1

msysを使わない場合はmozjpegのみが使えますので```USE_MOZJPEG```オプションは使用しません

    > mingw32-make -f makefile.mingw

## ソフトウエアの操作方法

+ clipssは常駐型アプリケーションです
+ 起動するとタスクトレイに格納され、マウスカーソルがクロス（Windows定義の十字）になります。ウインドウ／ダイアログ類は何も表示されません
+ マウスによる矩形選択の他、下記のようにキーボードと組み合わせます
  - ESCAPE　キャプチャを中断します（再開はタスクトレイのアイコンを右クリック）
  - Shift　ウインドウをキャプチャするモードに移行
  - Ctrl　ウインドウのクライアント領域をキャプチャするモードに移行
  - Alt　フルスクリーンをキャプチャするモードに移行
  - SPACE 矩形キャプチャに戻ります
+ clips.iniに設定された情報を元にキャプチャされ出力されます。タスクトレイアイコンを右クリック -> 「設定」からの設定ダイアログでも設定できます
+ 重なったウインドウなどのせいで、選択領域中の別の領域が邪魔な場合は再度上記のボタンを押してください、カーソル上の領域が再選択されます
+ もう一度キャプチャしたい場合はタスクトレイのアイコンを右クリックし、各モードを選択します
+ 終了方法は（モード中は中断後に）タスクトレイのアイコンを右クリックし、終了を選択します


## ビルドに関する補足事項

### msysを使わない場合の制限

- jpeg-9aは使えません。CMakeが使える環境でのみ構築するのでlibpng1.6とmozjpegの組み合わせになります。jpeg-9aを使用する場合はmsysを導入してください

### jpeg-9aのビルドに失敗する場合

- ```./configure```で作成される```jconfig.h```に（```#undef```されているはずの）```#define HAVE_PROTOTYPES 1```を付け加え有効にしてみてください。書き換えても上書きされる場合がありますので、個別に```make```すると解消されるかもしれません（patchが使えれば良いのですが・・・）


    5c5,6
    < #undef HAVE_PROTOTYPES
    ---
    > //#undef HAVE_PROTOTYPES
    > #define HAVE_PROTOTYPES 1


**ということもあって、msys環境の構築とmozjpegの利用を推奨します**

## その他補足事項

- 設定でカラーマネジメントが有効な時にはWindowsによって設定されたプロファイルを使用します。たいていの場合、お使いのディスプレイ販売元から配布されています。プロファイルの設定方法はWindowsの「色の管理」などをご参照ください
- 解像度が違うマルチディスプレイ環境でフルスクリーンキャプチャをする際、最大矩形から欠落する部分は黒色になります。例えば1920x1080と1920x1200で使用している場合は3840x1200でキャプチャされます。そして1920x120の矩形が黒色になります
- 使用方法によっては暴露ソフトになり得ます。機密情報やプライバシーの保護には十分注意してください


## 今後追加するべき機能

- 画像投稿SNSへの投稿サポート
- 撮影情報、Exifなどのメタデータを保存する **こともできる** オプション（現在は何も付けていません）
- DPI Virtualizationへの対応
- そもそもこのプロジェクトもCMakeにすれば良いんじゃ無いかなという気がしています
- 現状、起動と終了がわかりにくい状態なのでスプラッシュウインドウなどを付けてもいいかもしれませんね


## その他

- 多分コピーガードされている映像ソースを再生する動画プレイヤーは映像がマスクされて出力されると思います（つまりキャプチャできない）
- 現状ではDPI Virtualizationに対応していませんので、DPIを変えている場合（ディスプレイの設定で表示倍率を変えている場合など）は矩形が正しく計算できずに正確にキャプチャできない可能性があります
- 大きなPNGファイルの最適化はかなりの演算時間を要しますのでご注意ください
- 一応XPぐらいでも使えると思いますが、新しいOS推奨です
